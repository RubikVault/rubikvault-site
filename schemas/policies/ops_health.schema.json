{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://rubikvault.com/schemas/policies/ops_health.schema.json",
  "title": "ops_health policy v2.1",
  "type": "object",
  "required": ["schema_version", "health", "telemetry", "mode_matrix"],
  "properties": {
    "schema_version": { "type": "string" },
    "health": {
      "type": "object",
      "required": ["source_of_truth", "required_checks", "verdict_order"],
      "properties": {
        "source_of_truth": {
          "type": "object",
          "required": ["root_status_path", "status_layout_policy_path"],
          "properties": {
            "root_status_path": { "type": "string" },
            "status_layout_policy_path": { "type": "string" }
          },
          "additionalProperties": false
        },
        "required_checks": {
          "type": "array",
          "items": { "type": "string" }
        },
        "verdict_order": {
          "type": "array",
          "items": { "type": "string" }
        }
      },
      "additionalProperties": false
    },
    "telemetry": {
      "type": "object",
      "required": ["non_blocking_checks", "ui_treatment"],
      "properties": {
        "non_blocking_checks": {
          "type": "array",
          "items": { "type": "string" }
        },
        "ui_treatment": {
          "type": "object",
          "required": ["INFO_is_neutral", "N_A_label", "INFO_label"],
          "properties": {
            "INFO_is_neutral": { "type": "boolean" },
            "N_A_label": { "type": "string" },
            "INFO_label": { "type": "string" }
          },
          "additionalProperties": false
        }
      },
      "additionalProperties": false
    },
    "mode_matrix": {
      "type": "object",
      "required": ["preview", "prod"],
      "properties": {
        "preview": {
          "type": "object",
          "required": ["telemetry_expected", "scheduler_expected", "pipeline_expected", "ui_trace_required", "static_persist_required"],
          "properties": {
            "telemetry_expected": { "type": "boolean" },
            "scheduler_expected": { "type": "boolean" },
            "pipeline_expected": { "type": "string" },
            "ui_trace_required": { "type": "boolean" },
            "static_persist_required": { "type": "boolean" }
          },
          "additionalProperties": false
        },
        "prod": {
          "type": "object",
          "required": ["telemetry_expected", "scheduler_expected", "pipeline_expected", "ui_trace_required", "static_persist_required"],
          "properties": {
            "telemetry_expected": { "type": "boolean" },
            "scheduler_expected": { "type": "boolean" },
            "pipeline_expected": { "type": "string" },
            "ui_trace_required": { "type": "boolean" },
            "static_persist_required": { "type": "boolean" }
          },
          "additionalProperties": false
        }
      },
      "additionalProperties": false
    }
  },
  "additionalProperties": false
}
