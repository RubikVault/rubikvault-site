{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Manifest v3.0 - Modules",
  "description": "Single source of truth for published modules state (Mission Control v3.0)",
  "type": "object",
  "required": ["schema_version", "published_at", "publish_policy", "modules", "summary"],
  "additionalProperties": true,
  "properties": {
    "schema_version": {
      "type": "string",
      "const": "3.0"
    },
    "published_at": {
      "type": "string",
      "description": "ISO8601 timestamp of publish"
    },
    "publish_policy": {
      "type": "string"
    },
    "build_id": {
      "type": "string",
      "description": "Canonical build identifier for traceability"
    },
    "active_build_id": {
      "type": "string",
      "description": "Legacy alias for build_id"
    },
    "manifest_ref": {
      "type": "string",
      "description": "Stable reference for this manifest/build"
    },
    "modules": {
      "type": "object",
      "description": "Per-module state mapping (module id as key)",
      "additionalProperties": {
        "type": "object",
        "required": ["tier", "status", "published", "digest"],
        "additionalProperties": true,
        "properties": {
          "tier": { "type": "string" },
          "domain": { "type": "string" },
          "status": { "type": "string" },
          "published": { "type": "boolean" },
          "digest": { "type": "string" },
          "fetched_at": { "type": "string" },
          "build_id": { "type": "string" },
          "manifest_ref": { "type": "string" },
          "freshness": {
            "type": "object",
            "additionalProperties": true
          },
          "cache": {
            "type": "object",
            "additionalProperties": true,
            "properties": {
              "kv_enabled": { "type": "boolean" },
              "preferred_source": { "type": "string" }
            }
          }
        }
      }
    },
    "summary": {
      "type": "object",
      "additionalProperties": true,
      "properties": {
        "modules_total": { "type": "integer", "minimum": 0 },
        "ok": { "type": "integer", "minimum": 0 },
        "warn": { "type": "integer", "minimum": 0 },
        "error": { "type": "integer", "minimum": 0 },
        "stale_ratio": { "type": "number", "minimum": 0 },
        "critical_ok": { "type": "boolean" }
      }
    }
  }
}
