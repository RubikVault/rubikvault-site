<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>RubikVault â€“ US Market Intelligence</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="style.css" />
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/sortablejs@latest/Sortable.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/dompurify@3.0.6/dist/purify.min.js"></script> <!-- ErgÃ¤nzt fÃ¼r Sicherheit (Tip 6) -->
</head>
<body>

  <!-- HEADER -->
  <header class="rv-header">
    <div class="rv-header-left">
        <a href="index.html" class="rv-logo">
          <div class="rv-logo-mark" aria-hidden="true">
            <svg viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg">
              <defs>
                <linearGradient id="rv-vault-door-5" x1="0%" y1="0%" x2="100%" y2="100%">
                  <stop offset="0%" stop-color="#111827" />
                  <stop offset="100%" stop-color="#020617" />
                </linearGradient>
                <radialGradient id="rv-vault-glow-5" cx="50%" cy="50%" r="60%">
                  <stop offset="0%" stop-color="#38bdf8" stop-opacity="0.9" />
                  <stop offset="100%" stop-color="#1d4ed8" stop-opacity="0" />
                </radialGradient>
              </defs>
              <rect x="80" y="80" width="352" height="352" rx="48" fill="url(#rv-vault-door-5)" stroke="#1f2937" stroke-width="8" />
              <circle cx="120" cy="120" r="8" fill="#64748b" />
              <circle cx="392" cy="120" r="8" fill="#64748b" />
              <circle cx="120" cy="392" r="8" fill="#64748b" />
              <circle cx="392" cy="392" r="8" fill="#64748b" />
              <circle cx="256" cy="256" r="130" fill="none" stroke="url(#rv-vault-glow-5)" stroke-width="14" />
              <g transform="translate(186,186)">
                <rect x="0"  y="0" width="40" height="40" rx="6" fill="#f97316" />
                <rect x="44" y="0" width="40" height="40" rx="6" fill="#0ea5e9" />
                <rect x="88" y="0" width="40" height="40" rx="6" fill="#22c55e" />
                <rect x="0"  y="44" width="40" height="40" rx="6" fill="#facc15" />
                <rect x="44" y="44" width="40" height="40" rx="6" fill="#ef4444" />
                <rect x="88" y="44" width="40" height="40" rx="6" fill="#6366f1" />
                <rect x="0"  y="88" width="40" height="40" rx="6" fill="#22c55e" />
                <rect x="44" y="88" width="40" height="40" rx="6" fill="#0ea5e9" />
                <rect x="88" y="88" width="40" height="40" rx="6" fill="#f97316" />
              </g>
            </svg>
          </div>
          <div class="rv-logo-text">RubikVault</div>
        </a>
    </div>
    <div class="rv-header-right">
      <!-- Market Timer -->
      <div class="market-timer">
        <div class="market-timer-top">
          <span id="mt-status">CLOSED</span>
          <div id="mt-dot" class="status-dot status-closed"></div>
        </div>
        <div id="mt-time" class="market-timer-bottom">NY: 00:00</div>
      </div>
      <!-- Theme Switch -->
      <button id="theme-toggle" class="theme-switch" aria-label="Toggle theme">ðŸŒ™</button>
    </div>
  </header>

  <main class="rv-main">
    <!-- Hero Section with 3-Second Clarity -->
    <section class="rv-hero rv-section">
      <h1>Decode the Markets with RubikVault</h1>
      <p>Get focused, data-driven insights without the noise. Better than scattered widgets: curated briefs, consensus scores, and personalized watchlists. Updated every 5 minutes for news, 1 minute for quotes.</p>
      <p id="hero-last-update" aria-live="polite">Last Update: News at --:--, Quotes at --:--</p>
      <!-- Onboarding (Shown only first visit) -->
      <details id="onboarding" open>
        <summary>How to Use RubikVault</summary>
        <ul>
          <li>Add stocks to your watchlist (up to 5 free) for quick tracking.</li>
          <li>Drag & drop sections to customize your dashboard.</li>
          <li>Check the Market Consensus Score (MCS) for sentiment at a glance.</li>
        </ul>
      </details>
    </section>

    <!-- Dev Panel (only if dev mode) -->
    <div id="dev-panel" style="display:none; position:fixed; bottom:10px; right:10px; background:var(--rv-bg-alt); border:1px solid var(--rv-border); padding:10px; border-radius:8px; z-index:100;">
      <h3>Dev Panel</h3>
      <select id="news-variant">
        <option value="cards">News: Cards</option>
        <option value="compact">News: Compact</option>
        <option value="ticker">News: Ticker</option>
      </select>
      <select id="watchlist-variant">
        <option value="minimal">Watchlist: Minimal</option>
        <option value="detailed">Watchlist: Detailed</option>
        <option value="sparklines">Watchlist: Sparklines</option>
      </select>
      <select id="charts-variant">
        <option value="minimal30d">Charts: Minimal 30d</option>
        <option value="compact">Charts: Compact</option>
      </select>
      <select id="layout-mode">
        <option value="fixed">Layout: Fixed</option>
        <option value="sortable">Layout: Sortable</option>
      </select>
      <select id="insight-variant">
        <option value="brief">Insight: Brief</option>
        <option value="expanded">Insight: Expanded</option>
      </select>
      <button onclick="RV.saveVariants()">Save & Reload</button>
    </div>

    <!-- Daily Insight Box -->
    <section class="rv-section" data-module="daily-insight">
      <div class="test-label">Daily Insight</div>
      <div class="rv-tv-box rv-daily-insight">
        <p id="daily-brief" aria-live="polite">Loading daily brief... (Lesezeit: 90 Sekunden)</p>
        <p id="rubik-note">RubikVault Notiz: Ignorieren Sie den Kerzen-Hype â€“ fokussieren Sie auf langfristige Trends.</p>
        <button id="read-aloud" aria-label="Read Daily Brief Aloud">ðŸ”Š Read Out Loud</button>
      </div>
      <div class="error-fallback" style="display:none;">Dieses Modul konnte nicht geladen werden. <button onclick="RV.modules.dailyInsight.render()">Reload</button></div>
    </section>

    <!-- Market Consensus Score (MCS) Gauge -->
    <section class="rv-section" data-module="mcs">
      <div class="test-label">Market Consensus Score</div>
      <div class="rv-gauge-box">
        <canvas id="mcs-chart"></canvas>
        <div id="mcs-value" class="rv-gauge-value">--</div>
        <div id="mcs-label" class="rv-gauge-label">Sentiment Score</div>
      </div>
      <details>
        <summary>Was bedeutet das?</summary>
        <p>MCS ist der Mittelwert des News-Sentiments (0-100). Hohe Unsicherheit, wenn StdDev > 20. Basierend auf den letzten 50 News.</p>
      </details>
      <div class="error-fallback" style="display:none;">Dieses Modul konnte nicht geladen werden. <button onclick="RV.modules.mcs.render()">Reload</button></div>
    </section>

    <!-- Watchlist with Autocomplete and Limit -->
    <section class="rv-section" data-module="watchlist">
      <div class="test-label">Watchlist (max 5 free)</div>
      <div class="rv-watchlist-box">
        <div class="rv-watchlist-input-group">
          <input id="wl-input" type="text" placeholder="Add Symbol (e.g. AAPL)" />
          <button id="wl-add-btn">Add</button>
          <div id="wl-suggestions" class="rv-suggestions"></div>
        </div>
        <div id="wl-container" class="rv-watchlist-grid"></div>
        <button id="wl-export" aria-label="Export Watchlist">Export JSON</button>
      </div>
      <div class="error-fallback" style="display:none;">Dieses Modul konnte nicht geladen werden. <button onclick="RV.modules.watchlist.render()">Reload</button></div>
    </section>

    <!-- Stock Explorer -->
    <section class="rv-section rv-explorer" data-module="stock-explorer">
      <div class="test-label">Stock Explorer</div>
      <div class="rv-explorer-grid">
        <div class="rv-stock-list-panel">
          <div class="rv-list-tabs">
            <button class="rv-list-tab active" onclick="loadStockList('nasdaq')">NASDAQ</button>
            <button class="rv-list-tab" onclick="loadStockList('dow')">DOW</button>
            <button class="rv-list-tab" onclick="loadStockList('sp500')">S&P500</button>
          </div>
          <div class="rv-stock-search">
            <input id="stockSearch" type="text" placeholder="Filter List..." onkeyup="filterStocks()" />
          </div>
          <div id="rv-stock-list-container" class="rv-stock-list-items"></div>
        </div>
        <div class="rv-charts-panel">
          <div class="rv-chart-header">
            <span id="rv-selected-stock-name">Apple Inc (AAPL)</span>
          </div>
          <div class="grid-2">
            <div class="rv-tv-box" style="height: 500px;" id="container-fundamentals"></div>
            <div class="rv-tv-box" style="height: 500px;" id="container-technicals"></div>
          </div>
          <!-- Custom Chart -->
          <div class="rv-tv-box" style="height: 300px; margin-top:20px;">
            <canvas id="custom-chart"></canvas>
          </div>
        </div>
      </div>
      <div class="error-fallback" style="display:none;">Dieses Modul konnte nicht geladen werden. <button onclick="RV.modules.stockExplorer.render()">Reload</button></div>
    </section>

    <!-- Heatmap -->
    <section class="rv-section" data-module="heatmap">
      <div class="test-label">Option G: Heatmap</div>
      <div class="rv-tv-box" style="height: 600px;">
        <div class="tradingview-widget-container">
          <div class="tradingview-widget-container__widget"></div>
          <script type="text/javascript" src="https://s3.tradingview.com/external-embedding/embed-widget-stock-heatmap.js" async>
          { "exchanges": ["NASDAQ", "NYSE"], "type": "sector", "width": "100%", "height": "100%", "range": "1M", "plotGradient": { "color1": "#10b981", "color2": "#ef4444" }, "colorTheme": "dark", "locale": "en", "range_type": "change" }
          </script>
        </div>
      </div>
      <div class="error-fallback" style="display:none;">Dieses Modul konnte nicht geladen werden. <button onclick="RV.modules.heatmap.render()">Reload</button></div>
    </section>

    <!-- Timeline -->
    <section class="rv-section" data-module="timeline">
      <div class="test-label">Option H: Timeline</div>
      <div class="grid-2">
        <div class="rv-tv-box" style="height: 600px;">
          <div class="tradingview-widget-container">
            <div class="tradingview-widget-container__widget"></div>
            <script type="text/javascript" src="https://s3.tradingview.com/external-embedding/embed-widget-timeline.js" async>
            { "feedMode": "market", "market": "stock", "isTransparent": true, "colorTheme": "dark", "locale": "en", "width": "100%", "height": "100%" }
            </script>
          </div>
        </div>
        <div class="rv-tv-box" style="height: 600px;">
          <div class="tradingview-widget-container">
            <div class="tradingview-widget-container__widget"></div>
            <script type="text/javascript" src="https://s3.tradingview.com/external-embedding/embed-widget-events.js" async>
            { "width": "100%", "height": "100%", "colorTheme": "dark", "isTransparent": true, "locale": "en", "importance": "3", "currencyInfo": "USD" }
            </script>
          </div>
        </div>
      </div>
      <div class="error-fallback" style="display:none;">Dieses Modul konnte nicht geladen werden. <button onclick="RV.modules.timeline.render()">Reload</button></div>
    </section>

    <!-- Dashboard Grid with News -->
    <section class="rv-section rv-dashboard-grid" data-module="dashboard">
      <div class="rv-dash-main">
        <div class="test-label">Option J: Chart Context</div>
        <div class="rv-tv-box" style="height: 600px;">
          <div class="tradingview-widget-container">
            <div class="tradingview-widget-container__widget"></div>
            <script type="text/javascript" src="https://s3.tradingview.com/external-embedding/embed-widget-advanced-chart.js" async>
            { "width": "100%", "height": "100%", "symbol": "NASDAQ:QQQ", "interval": "D", "timezone": "America/New_York", "theme": "dark", "style": "1", "locale": "en", "enable_publishing": false, "allow_symbol_change": true, "calendar": false, "support_host": "https://www.tradingview.com" }
            </script>
          </div>
        </div>
      </div>
    
      <div class="rv-dash-sidebar">
        <div class="test-label">Option J: Live Market News (Real-Time)</div>
        <div class="rv-tv-box" style="height: 600px; padding:0; overflow-y: hidden; display:flex; flex-direction:column;">
          <div class="rv-news-header">
            <div class="rv-news-tabs">
              <button class="rv-news-tab active" data-tab="finance">Finance</button>
              <button class="rv-news-tab" data-tab="general">General</button>
            </div>
            <span id="news-last-update" style="font-size:11px; color:var(--rv-text-muted);">Last: --:--</span>
            <button onclick="RV.modules.newsFeed.fetchAndRender()" class="rv-refresh-btn">â†» Refresh</button>
          </div>
          <div id="rv-news-feed-list" class="rv-news-list-container" style="overflow-y:auto; flex:1;">
            <!-- JS fills this -->
          </div>
        </div>
      </div>
      <div class="error-fallback" style="display:none;">Dieses Modul konnte nicht geladen werden. <button onclick="RV.modules.dashboard.render()">Reload</button></div>
    </section>

    <!-- Offline Fallback -->
    <div id="offline-fallback" style="display:none; text-align:center; padding:20px; background:var(--rv-danger); color:#fff;">
      Offline-Modus: Daten von letztem Cache. <button onclick="location.reload()">Versuchen Sie online zu gehen</button>
    </div>

  </main>

  <footer class="rv-footer">
    <div class="rv-footer-links">
        <a href="imprint.html">Imprint</a>
        <a href="privacy.html">Privacy</a>
        <a href="disclaimer.html">Disclaimer</a>
    </div>
    &copy; 2025 RubikVault.
  </footer>

  <script src="script.js" defer></script>
</body>
</html>