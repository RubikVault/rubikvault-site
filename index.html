<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>RubikVault ‚Äì US Market Intelligence. No Hype.</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="style.css" />
  <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/dompurify@3.0.6/dist/purify.min.js"></script>
  <link rel="manifest" href="manifest.json">
</head>
<body>
  <header class="rv-header">
    <div class="rv-header-left">
        <a href="index.html" class="rv-logo">
          <div class="rv-logo-mark" aria-hidden="true">
            <svg viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg">
              <defs>
                <linearGradient id="rv-vault-door-5" x1="0%" y1="0%" x2="100%" y2="100%">
                  <stop offset="0%" stop-color="#111827" />
                  <stop offset="100%" stop-color="#020617" />
                </linearGradient>
                <radialGradient id="rv-vault-glow-5" cx="50%" cy="50%" r="50%">
                  <stop offset="0%" stop-color="rgba(0, 229, 255, 0.4)" />
                  <stop offset="100%" stop-color="rgba(0, 229, 255, 0)" />
                </radialGradient>
              </defs>
              <rect width="512" height="512" rx="100" fill="url(#rv-vault-door-5)" />
              <circle cx="256" cy="256" r="180" fill="#0f172a" />
              <g transform="translate(10, 10)">
                <circle cx="256" cy="256" r="170" stroke="#00e5ff" stroke-width="2" fill="none" />
                <path d="M256 96L256 416M96 256L416 256M150 150L362 362M150 362L362 150" stroke="#00e5ff" stroke-width="15" stroke-linecap="round" fill="none" opacity="0.3" />
                <circle cx="256" cy="256" r="40" fill="#00e5ff" />
              </g>
              <circle cx="256" cy="256" r="256" fill="url(#rv-vault-glow-5)" opacity="0.1" />
            </svg>
          </div>
          RubikVault
        </a>
        <div class="rv-header-prop" id="rv-value-proposition">
            US Market Intelligence. <span class="rv-text-muted">No Hype, just Data.</span>
        </div>
    </div>
    <div class="rv-header-right">
        <div class="rv-market-timer" id="market-timer">US Market Closed</div>
        <button id="theme-toggle" class="rv-toggle-btn">Theme</button>
    </div>
  </header>

  <main class="rv-main">
    <details id="rv-onboarding-tip" class="rv-onboarding-box" open>
      <summary class="rv-onboarding-summary">
          <span style="font-weight:600;">üëã Willkommen!</span> So nutzen Sie RubikVault optimal (Lesezeit: 30 Sek.)
      </summary>
      <div class="rv-onboarding-content">
          <ul>
              <li>**Personalisieren:** Nutzen Sie das Stern-Icon (‚≠ê) neben Tickern, um Ihre Watchlist (Max. 5) zu speichern.</li>
              <li>**Anpassen:** Verschieben Sie Module (Drag & Drop) und nutzen Sie den **Dark/Light** Toggle oben rechts.</li>
              <li>**Insights verstehen:** Achten Sie auf den **MCS** (Market Consensus Score) ‚Äì er zeigt die Stimmung der Nachrichtenlage.</li>
          </ul>
      </div>
    </details>

    <div class="rv-update-row" aria-live="polite">
        <span id="rv-update-quotes">Quotes: Loading...</span>
        <span id="rv-update-news">News: Loading...</span>
        <span id="rv-update-mcs">MCS: Loading...</span>
    </div>

    <div class="rv-dash-grid" id="rv-dash-grid">
        
        <section class="rv-dash-box rv-insight-box" data-module="insight">
            <h3 class="rv-insight-title">‚ö° Overnight Pulse & RubikVault Take</h3>
            <div id="rv-daily-insight-content" class="rv-insight-content">
                <div class="rv-insight-note">
                    <span id="rv-insight-brief">Initialisiere Marktanalyse...</span>
                </div>
                <p class="rv-insight-take" id="rv-insight-take">
                    <span style="font-weight: 600;">Mein Take:</span> Warte auf die MCS-Daten. Aktuell kein Kerzen-Alarm. Konzentriere dich auf die Sektor-Rotation.
                </p>
            </div>
            <button id="rv-read-out-loud-btn" class="rv-read-btn" aria-label="Lies Daily Insight vor">üîä</button>
        </section>

        <section class="rv-dash-box rv-watchlist-box" data-module="watchlist">
            <h3 class="rv-box-title">‚≠ê Deine Watchlist <span id="rv-watchlist-limit-badge" class="rv-limit-badge">0/5</span></h3>
            <div id="rv-watchlist-list" class="rv-stock-list-container">
                <p class="rv-text-muted" style="padding: 10px;">F√ºge Aktien √ºber das Stern-Icon hinzu.</p>
            </div>
        </section>
        
        <div class="rv-dash-box rv-wide-box" data-module="main-chart">
            <h3 class="rv-box-title">Option A: Index Performance (NASDAQ 100)</h3>
            <div class="rv-tv-box" style="height: 380px;">
                <div id="tv-chart-qqq-container" class="tradingview-widget-container" style="height: 100%; width: 100%;">
                    <script type="text/javascript" src="https://s3.tradingview.com/external-embedding/embed-widget-advanced-chart.js" async>
                    { "width": "100%", "height": "100%", "symbol": "NASDAQ:QQQ", "interval": "D", "timezone": "America/New_York", "theme": "dark", "style": "1", "locale": "en", "enable_publishing": false, "allow_symbol_change": true, "calendar": false, "support_host": "https://www.tradingview.com" }
                    </script>
                </div>
            </div>
        </div>

        <section class="rv-dash-box rv-mcs-gauge-container" data-module="mcs-gauge">
            <h3 class="rv-box-title">D3. Market Consensus Score (MCS) <span id="rv-mcs-uncertainty-badge" class="rv-limit-badge rv-warning" style="display:none;">Uncertainty</span></h3>
            <div id="rv-mcs-gauge-box" class="rv-gauge-box">
                <canvas id="mcsGauge"></canvas>
                <div class="rv-gauge-value" id="mcsValue">--</div>
                <div class="rv-gauge-label" id="mcsLabel">Loading...</div>
                <button class="rv-help-btn" onclick="alert('Der Market Consensus Score misst die durchschnittliche Stimmung aller Finance-News und zeigt die Konsensst√§rke an. Hoch (+): Bullish, Niedrige StdDev: Starker Konsens.')">?</button>
            </div>
        </section>
        
        <div class="rv-dash-box" data-module="market-timer">
            <h3 class="rv-box-title">Option B: Key Indices Status</h3>
            <div class="rv-market-data-list">
                </div>
        </div>
        
        <div class="rv-dash-box rv-wide-box" data-module="stock-explorer">
            <h3 class="rv-box-title">Option C: Stock Explorer <span id="rv-explorer-stock-name">Apple Inc</span></h3>
            <div class="rv-explorer-content">
                <div class="rv-explorer-selector">
                    <input type="text" id="stockSearch" onkeyup="filterStocks()" placeholder="Search Ticker..." />
                    <div id="stock-list-container" class="rv-stock-list-container">
                        </div>
                </div>
                <div class="rv-explorer-widgets">
                    <div class="rv-explorer-chart" id="rv-explorer-chart">
                        <div class="rv-skeleton-chart" style="height: 100%;"></div>
                    </div>
                    <div class="rv-explorer-info" id="rv-explorer-info">
                        <div class="rv-tv-box" style="height: 100%;">
                            <div id="tv-financials-container" class="tradingview-widget-container" style="height: 100%; width: 100%;">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="rv-dash-box rv-dash-sidebar" data-module="news-feed">
            <h3 class="rv-box-title">D1. Live Market News (5 Min Cache)</h3>
            <div class="rv-tv-box" style="height: 600px; padding:0; overflow-y: hidden; display:flex; flex-direction:column;">
                <div class="rv-news-header">
                    <div class="rv-tab-container">
                        <button class="rv-tab-btn active" data-tab="finance">Finance Focus</button>
                        <button class="rv-tab-btn" data-tab="general">General Business</button>
                    </div>
                    <button onclick="RV.NewsFeed.fetchNews()" class="rv-refresh-btn">‚Üª Refresh</button>
                </div>
                <div id="rv-news-feed-list" class="rv-news-list-container" style="overflow-y:auto; flex:1;">
                    <div class="rv-loading-skeleton"></div>
                    </div>
            </div>
        </div>
    </div>

  </main>

  <footer class="rv-footer">
    <div class="rv-footer-top">
        <div class="rv-logo">RubikVault</div>
        <div class="rv-footer-links">
            <a href="disclaimer.html">Disclaimer</a>
            <a href="imprint.html">Imprint</a>
            <a href="privacy.html">Privacy</a>
        </div>
    </div>
    <div class="rv-footer-bottom">
        <p>Built with data-driven insights. Designed for stability and clarity.</p>
        <div id="rv-analytics-placeholder"></div>
    </div>
  </footer>

  <script src="script.js"></script>
  <script>
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('/service-worker.js')
          .then(reg => console.log('Service Worker registered:', reg.scope))
          .catch(err => console.error('Service Worker registration failed:', err));
      });
    }
  </script>
</body>
</html>