{
  "schema_version": "3.0",
  "failure_classes": {
    "UPSTREAM_TIMEOUT": {
      "severity": "warn",
      "category": "upstream",
      "explanation": "Provider API did not respond within timeout",
      "next_action": "WAIT",
      "user_message": "Data provider temporarily slow. Auto-retry scheduled.",
      "auto_resolve": true,
      "retry_strategy": "exponential_backoff"
    },
    "UPSTREAM_429": {
      "severity": "warn",
      "category": "upstream",
      "explanation": "Rate limit exceeded from provider",
      "next_action": "WAIT",
      "user_message": "Rate limit reached. Next update in scheduled window.",
      "auto_resolve": true,
      "retry_strategy": "respect_retry_after"
    },
    "UPSTREAM_HTTP_5XX": {
      "severity": "warn",
      "category": "upstream",
      "explanation": "Provider server error (5xx)",
      "next_action": "WAIT",
      "user_message": "Provider experiencing issues. Auto-retry scheduled.",
      "auto_resolve": true,
      "retry_strategy": "exponential_backoff"
    },
    "UPSTREAM_SCHEMA_BREAK": {
      "severity": "crit",
      "category": "upstream",
      "explanation": "Provider changed API response format unexpectedly",
      "next_action": "FIX_PARSER",
      "user_message": "Data format changed. Manual fix required.",
      "auto_resolve": false,
      "retry_strategy": "none"
    },
    "VALIDATION_FAILED_SCHEMA": {
      "severity": "crit",
      "category": "validation",
      "explanation": "Envelope does not match v3.0 schema",
      "next_action": "FIX_PROVIDER",
      "user_message": "Data validation failed. Technical issue.",
      "auto_resolve": false,
      "retry_strategy": "none"
    },
    "VALIDATION_FAILED_COUNTS": {
      "severity": "warn",
      "category": "validation",
      "explanation": "Record count outside expected range",
      "next_action": "ADJUST_RULES",
      "user_message": "Data count unexpected. Reviewing...",
      "auto_resolve": false,
      "retry_strategy": "none"
    },
    "VALIDATION_FAILED_RANGE": {
      "severity": "warn",
      "category": "validation",
      "explanation": "Values outside plausibility ranges",
      "next_action": "CHECK_DATA",
      "user_message": "Data values unexpected. Reviewing...",
      "auto_resolve": false,
      "retry_strategy": "none"
    },
    "VALIDATION_DROPS_EXCEEDED": {
      "severity": "crit",
      "category": "validation",
      "explanation": "Too many records dropped during validation",
      "next_action": "FIX_PARSER",
      "user_message": "Data quality issue. Manual fix required.",
      "auto_resolve": false,
      "retry_strategy": "none"
    },
    "PLAUSIBILITY_FAILED": {
      "severity": "crit",
      "category": "validation",
      "explanation": "Plausibility rules failed (values out of expected bounds)",
      "next_action": "CHECK_DATA",
      "user_message": "Data plausibility check failed.",
      "auto_resolve": false,
      "retry_strategy": "none"
    },
    "UI_CONTRACT_FAILED": {
      "severity": "crit",
      "category": "validation",
      "explanation": "Required UI paths missing or invalid",
      "next_action": "FIX_PROVIDER",
      "user_message": "Required data fields missing.",
      "auto_resolve": false,
      "retry_strategy": "none"
    },
    "MANIFEST_INVALID": {
      "severity": "crit",
      "category": "publish",
      "explanation": "Manifest JSON schema validation failed",
      "next_action": "FIX_AGGREGATOR",
      "user_message": "System configuration issue.",
      "auto_resolve": false,
      "retry_strategy": "none"
    },
    "MANIFEST_ASSET_MISMATCH": {
      "severity": "crit",
      "category": "publish",
      "explanation": "Manifest digest does not match asset digest",
      "next_action": "FIX_AGGREGATOR",
      "user_message": "Data integrity check failed.",
      "auto_resolve": false,
      "retry_strategy": "none"
    },
    "PUBLISH_BLOCKED_CRITICAL": {
      "severity": "crit",
      "category": "publish",
      "explanation": "Critical module error blocks entire publish",
      "next_action": "FIX_CRITICAL_MODULE",
      "user_message": "Critical data unavailable. Using last good.",
      "auto_resolve": false,
      "retry_strategy": "none"
    },
    "KV_READ_FAILED": {
      "severity": "warn",
      "category": "cache",
      "explanation": "KV read timeout or error",
      "next_action": "FALLBACK_ASSET",
      "user_message": null,
      "auto_resolve": true,
      "retry_strategy": "immediate_fallback"
    },
    "KV_WRITE_FAILED": {
      "severity": "warn",
      "category": "cache",
      "explanation": "KV write failed (not critical, asset is truth)",
      "next_action": "MONITOR",
      "user_message": null,
      "auto_resolve": true,
      "retry_strategy": "skip"
    },
    "KV_WRITE_SKIPPED_NO_CHANGE": {
      "severity": "info",
      "category": "cache",
      "explanation": "KV write skipped (digest unchanged, defensive dedup)",
      "next_action": "NONE",
      "user_message": null,
      "auto_resolve": true,
      "retry_strategy": "none"
    },
    "ASSET_FETCH_FAILED": {
      "severity": "crit",
      "category": "delivery",
      "explanation": "Could not fetch asset from /data/snapshots",
      "next_action": "CHECK_DEPLOY",
      "user_message": "Data temporarily unavailable.",
      "auto_resolve": false,
      "retry_strategy": "immediate_fallback_maintenance"
    },
    "PROVIDER_STATE_UNAVAILABLE": {
      "severity": "warn",
      "category": "observability",
      "explanation": "provider-state.json not found or invalid",
      "next_action": "FALLBACK_MANIFEST",
      "user_message": null,
      "auto_resolve": true,
      "retry_strategy": "fallback"
    },
    "UNKNOWN_ERROR": {
      "severity": "crit",
      "category": "system",
      "explanation": "Unclassified error occurred",
      "next_action": "CHECK_LOGS",
      "user_message": "Technical issue occurred.",
      "auto_resolve": false,
      "retry_strategy": "none"
    }
  },
  "next_actions": {
    "WAIT": {
      "description": "Auto-retry will resolve. No action needed.",
      "user_action": false
    },
    "FIX_PARSER": {
      "description": "Update parser/normalizer for provider changes",
      "user_action": true
    },
    "FIX_PROVIDER": {
      "description": "Fix provider script logic",
      "user_action": true
    },
    "ADJUST_RULES": {
      "description": "Update validation rules in registry",
      "user_action": true
    },
    "CHECK_DATA": {
      "description": "Investigate data source or provider API",
      "user_action": true
    },
    "FIX_AGGREGATOR": {
      "description": "Fix finalizer/aggregator logic",
      "user_action": true
    },
    "FIX_CRITICAL_MODULE": {
      "description": "Resolve critical module error first",
      "user_action": true
    },
    "FALLBACK_ASSET": {
      "description": "System automatically fell back to asset",
      "user_action": false
    },
    "MONITOR": {
      "description": "Monitor for recurring issues",
      "user_action": false
    },
    "NONE": {
      "description": "No action required",
      "user_action": false
    },
    "CHECK_DEPLOY": {
      "description": "Verify Cloudflare Pages deployment succeeded",
      "user_action": true
    },
    "FALLBACK_MANIFEST": {
      "description": "System automatically fell back to manifest",
      "user_action": false
    },
    "CHECK_LOGS": {
      "description": "Review GitHub Actions logs for stack trace",
      "user_action": true
    }
  },
  "severity_levels": {
    "info": {
      "color": "#3b82f6",
      "icon": "‚ÑπÔ∏è",
      "description": "Informational, no action needed"
    },
    "warn": {
      "color": "#f59e0b",
      "icon": "‚ö†Ô∏è",
      "description": "Warning, may self-resolve"
    },
    "crit": {
      "color": "#ef4444",
      "icon": "üî¥",
      "description": "Critical, requires attention"
    }
  }
}
